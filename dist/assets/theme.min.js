/*! concept-usine v1.0.0 | (c) 2021 STUDIO ZERANCE | http://link-to-your-git-repo.com */
!function(){"use strict";var doT={name:"doT",version:"1.1.1",templateSettings:{evaluate:/\{\$([\s\S]+?(\}?)+)\}\}/g,interpolate:/\{\$=([\s\S]+?)\}\}/g,encode:/\{\$!([\s\S]+?)\}\}/g,use:/\{\$#([\s\S]+?)\}\}/g,useParams:/(^|[^\w$])def(?:\.|\[[\'\"])([\w$\.]+)(?:[\'\"]\])?\s*\:\s*([\w$\.]+|\"[^\"]+\"|\'[^\']+\'|\{[^\}]+\})/g,define:/\{\$##\s*([\w\.$]+)\s*(\:|=)([\s\S]+?)#\}\}/g,defineParams:/^\s*([\w$]+):([\s\S]+)/,conditional:/\{\$\?(\?)?\s*([\s\S]*?)\s*\}\}/g,iterate:/\{\$~\s*(?:\}\}|([\s\S]+?)\s*\:\s*([\w$]+)\s*(?:\:\s*([\w$]+))?\s*\}\})/g,varname:"zerance",strip:!0,append:!0,selfcontained:!1,doNotSkipEncoded:!1},template:void 0,compile:void 0,log:!0},_globals;doT.encodeHTMLSource=function(t){var e={"&":"&#38;","<":"&#60;",">":"&#62;",'"':"&#34;","'":"&#39;","/":"&#47;"},o=t?/[&<>"'\/]/g:/&(?!#?\w+;)|<|>|"|'|\//g;return function(t){return t?t.toString().replace(o,function(t){return e[t]||t}):""}},_globals=function(){return this||(0,eval)("this")}(),"undefined"!=typeof module&&module.exports?module.exports=doT:"function"==typeof define&&define.amd?define(function(){return doT}):_globals.doT=doT;var startend={append:{start:"'+(",end:")+'",startencode:"'+encodeHTML("},split:{start:"';out+=(",end:");out+='",startencode:"';out+=encodeHTML("}},skip=/$^/;function resolveDefs(t,e,o){return("string"==typeof e?e:e.toString()).replace(t.define||skip,function(e,n,i,r){return 0===n.indexOf("def.")&&(n=n.substring(4)),n in o||(":"===i?(t.defineParams&&r.replace(t.defineParams,function(t,e,i){o[n]={arg:e,text:i}}),n in o||(o[n]=r)):new Function("def","def['"+n+"']="+r)(o)),""}).replace(t.use||skip,function(e,n){t.useParams&&(n=n.replace(t.useParams,function(t,e,n,i){if(o[n]&&o[n].arg&&i){var r=(n+":"+i).replace(/'|\\/g,"_");return o.__exp=o.__exp||{},o.__exp[r]=o[n].text.replace(new RegExp("(^|[^\\w$])"+o[n].arg+"([^\\w$])","g"),"$1"+i+"$2"),e+"def.__exp['"+r+"']"}}));var i=new Function("def","return "+n)(o);return i?resolveDefs(t,i,o):i})}function unescape(t){return t.replace(/\\('|\\)/g,"$1").replace(/[\r\t\n]/g," ")}doT.template=function(tmpl,c,def){c=c||doT.templateSettings;var cse=c.append?startend.append:startend.split,needhtmlencode,sid=0,indv,str=c.use||c.define?resolveDefs(c,tmpl,def||{}):tmpl;str=("var out='"+(c.strip?str.replace(/(^|\r|\n)\t* +| +\t*(\r|\n|$)/g," ").replace(/\r|\n|\t|\/\*[\s\S]*?\*\//g,""):str).replace(/'|\\/g,"\\$&").replace(c.interpolate||skip,function(m,code){try{for(var expressionParts=code.split(" | "),value=expressionParts[0],i=1;i<expressionParts.length;i++){var functionExpression=expressionParts[i],functionParts=functionExpression.split(":"),functionArgs=functionParts[1]?functionParts[1].split("&&"):[];functionArgs.map(t=>unescape(t).trim());for(var functionArgumentsExpression=`(${value}`,j=0;j<functionArgs.length;j++)functionArgumentsExpression+=", ",functionArgumentsExpression+=functionArgs[j];functionArgumentsExpression+=")";for(var functionName=functionParts[0].trim(),functionNameParts=functionName.split("."),functionNameExpression="",k=0;k<functionNameParts.length;k++)functionNameExpression+=`['${functionNameParts[k].trim()}']`;"function"==typeof eval(`window${functionNameExpression}`)&&(value=`window${functionNameExpression}${functionArgumentsExpression}`),console.log("Value ",value)}return cse.start+unescape(value)+cse.end}catch(t){console.error("Couldn't transform value",t,{code:code,value:value})}return cse.start+unescape(code)+cse.end}).replace(c.encode||skip,function(t,e){return needhtmlencode=!0,cse.startencode+unescape(e)+cse.end}).replace(c.conditional||skip,function(t,e,o){return e?o?"';}else if("+unescape(o)+"){out+='":"';}else{out+='":o?"';if("+unescape(o)+"){out+='":"';}out+='"}).replace(c.iterate||skip,function(t,e,o,n){return e?(sid+=1,indv=n||"i"+sid,e=unescape(e),"';var arr"+sid+"="+e+";if(arr"+sid+"){var "+o+","+indv+"=-1,l"+sid+"=arr"+sid+".length-1;while("+indv+"<l"+sid+"){"+o+"=arr"+sid+"["+indv+"+=1];out+='"):"';} } out+='"}).replace(c.evaluate||skip,function(t,e){return"';"+unescape(e)+"out+='"})+"';return out;").replace(/\n/g,"\\n").replace(/\t/g,"\\t").replace(/\r/g,"\\r").replace(/(\s|;|\}|^|\{)out\+='';/g,"$1").replace(/\+''/g,""),needhtmlencode&&(c.selfcontained||!_globals||_globals._encodeHTML||(_globals._encodeHTML=doT.encodeHTMLSource(c.doNotSkipEncoded)),str="var encodeHTML = typeof _encodeHTML !== 'undefined' ? _encodeHTML : ("+doT.encodeHTMLSource.toString()+"("+(c.doNotSkipEncoded||"")+"));"+str);try{return new Function(c.varname,str)}catch(t){throw"undefined"!=typeof console&&console.log("Could not create a template function: "+str),t}},doT.compile=function(t,e){return doT.template(t,null,e)}}();var toolBox={inheritPrototype:function(t,e){t.prototype=Object.create(e.prototype),Object.defineProperty(t.prototype,"constructor",{value:t,enumerable:!1,writable:!0})},getProp:function(t,e,o){const n=(Array.isArray(e)?e:e.split(".").filter(t=>t)).flatMap(t=>"string"==typeof t?t.split("."):t).reduce((t,e)=>t&&t[e],t);return n||0==n?n:o},isEmpty:function(t){var e="";if(1==arguments.length)e=arguments[0];else if(2==arguments.length){const t=arguments[0],o=arguments[1];e=toolBox.getProp(t,o)}return void 0===e||(null===e||("string"==typeof e&&!e.trim().length||(!(!Array.isArray(e)||e.length)||("object"==typeof e&&0===Object.keys(e).length||("function"==typeof e||"number"==typeof e||"boolean"==typeof e||Object.prototype.toString.call(e),!1)))))},getParameterByName:function(t,e){e||(e=window.location.href),t=t.replace(/[\[\]]/g,"\\$&");var o=new RegExp("[?&]"+t+"(=([^&#]*)|&|#|$)").exec(e);return o?o[2]?decodeURIComponent(o[2].replace(/\+/g," ")):"":null},setCookie:(t,e,o)=>{var n="";if(o){var i=new Date;i.setTime(i.getTime()+24*o*60*60*1e3),n="; expires="+i.toUTCString()}document.cookie=t+"="+(e||"")+n+"; path=/"},getCookie:t=>{for(var e=t+"=",o=document.cookie.split(";"),n=0;n<o.length;n++){for(var i=o[n];" "==i.charAt(0);)i=i.substring(1,i.length);if(0==i.indexOf(e))return i.substring(e.length,i.length)}return null},clearCookie:(t,e,o)=>{o=o||document.domain,e=e||"/",toolBox.getCookie(t)&&(document.cookie=t+"="+(e?";path="+e:"")+(o?";domain="+o:"")+";expires=Thu, 01 Jan 1970 00:00:01 GMT")},merge:function(t,e,o){var n,i;for(var r in o?(n=t,i=e):(n=JSON.parse(JSON.stringify(t)),i=JSON.parse(JSON.stringify(e))),i)try{i[r].constructor==Object?n[r]=MergeRecursive(n[r],i[r],!0):n[r]=i[r]}catch(t){n[r]=i[r]}return n},htmlToElement:function(t){var e=document.createElement("template");return t=t.trim(),e.innerHTML=t,e.content.firstChild},renderTemplate:function(t,e,o){return doT.template(document.getElementById(t).innerHTML,void 0,o)(e)},makeId:function(t,e){for(var o=[],n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",i=n.length;o.length<=t;)o.push(n.charAt(Math.floor(Math.random()*i)));return`${e.prefix?e.prefix:""}${o.join("")}${e.postfix?e.postfix:""}`},loadStyles:function(t){const e=document.createElement("style");if(e.setAttribute("type","text/css"),t.id&&e.setAttribute("id",t.id),t.url)e.setAttribute("href",t.url);else if(t.string)e.innerHTML=t.string;else if(t.object){const n=t.object,i=!isNaN(parseInt(t.min_width))&&t.min_width,r=!isNaN(parseInt(t.max_width))&&t.max_width,s=i||r;e.innerHTML=s?`@media screen ${i?` and (min-width: ${i}) `:""} ${r?` and (max-width: ${r}) `:""} {`:"";for(const t in n){const i=n[t];var o=Object.entries(i).map(([t,e])=>{var o=t.replace(/[A-Z]/g,t=>`-${t.toLowerCase()}`),n="background-image"==o||"background"==o&&e.includes("http")?`url(${e})`:e;return e&&"string"==typeof e&&""!==e.trim()?`${o}:${n}`:""}).join(";");e.innerHTML+=`${t} { ${o} }`}e.innerHTML+=s?"}":""}document.getElementsByTagName("head")[0].appendChild(e)},loadScript:function(t,e,o){var n,i=document.location.protocol.includes("http")?"https:"===document.location.protocol?"https://":"http://":"";n=t,function t(){if(!n.length)return e();var r=n.shift();if("string"!=typeof r||""==r.trim())return e();var s=document.createElement("script");s.type="text/javascript",s.async=!0,s.src=i+r,s.onload=s.onreadystatechange=function(t,e){var n=!1;return function(){n||this.readyState&&"complete"!=this.readyState||(n=!0,o(t),e())}}(r,t),(document.head||document.getElementsByTagName("head")[0]).appendChild(s)}()},hasAttribute:function(t,e){if(!t.properties)return!1;let o=JSON.parse(JSON.stringify(t.properties));Array.isArray(o)||(o=[o]);for(let t of o)if(t.name==e.name&&t.value==e.value)return!0;return!1}};!function(t,e){"use strict";"function"!=typeof t.CustomEvent&&(t.CustomEvent=function(t,o){o=o||{bubbles:!1,cancelable:!1,detail:void 0};var n=e.createEvent("CustomEvent");return n.initCustomEvent(t,o.bubbles,o.cancelable,o.detail),n},t.CustomEvent.prototype=t.Event.prototype),e.addEventListener("touchstart",function(t){if("true"===t.target.getAttribute("data-swipe-ignore"))return;a&&l();a=t.target,s=Date.now(),o=t.touches[0].clientX,n=t.touches[0].clientY,i=0,r=0},!1),e.addEventListener("touchmove",function(t){if(!o||!n)return;var e=t.touches[0].clientX,s=t.touches[0].clientY;i=o-e,r=n-s;var a=c();if(""===a)return;p(t,a,"swiping")},!1),e.addEventListener("touchend",function(t){if(a!==t.target)return l();var e=c();""!==e?p(t,e,"swiped"):l()},!1);var o=null,n=null,i=null,r=null,s=null,a=null;function l(){a&&(a.dispatchEvent(new CustomEvent("swipe-canceled",{bubbles:!0,cancelable:!0,detail:{}})),o=null,n=null,s=null,a=null)}function c(){var t="",e=parseInt(u(a,"data-swipe-threshold","80"),10),o=parseInt(u(a,"data-swipe-timeout","1000"),10),n=Date.now()-s;return Math.abs(i)>Math.abs(r)?Math.abs(i)>e&&n<o&&(t=i>0?"left":"right"):Math.abs(r)>e&&n<o&&(t=r>0?"up":"down"),t}function p(t,e,i){if(a===t.target){var r=t.changedTouches||t.touches||[],s=i+"-"+e,l={dir:e,xStart:parseInt(o,10),xEnd:parseInt((r[0]||{}).clientX||-1,10),yStart:parseInt(n,10),yEnd:parseInt((r[0]||{}).clientY||-1,10)};a.dispatchEvent(new CustomEvent(i,{bubbles:!0,cancelable:!0,detail:l})),a.dispatchEvent(new CustomEvent(s,{bubbles:!0,cancelable:!0,detail:l}))}}function u(t,o,n){for(;t&&t!==e.documentElement;){var i=t.getAttribute(o);if(i)return i;t=t.parentNode}return n}}(window,document);var ZDOM=function(){"use strict";var t=function(t){t?"document"===t?this.elems=[document]:"window"===t?this.elems=[window]:"string"==typeof t?this.elems=document.querySelectorAll(t):t instanceof NodeList?this.elems=t:t instanceof Element?this.elems=[t]:t instanceof DocumentFragment?this.elems=t.querySelectorAll("*"):this.elems=e([]):this.elems=e([])};t.prototype.ajax=function(t){console.log(t)},t.prototype.each=function(t){if(t&&"function"==typeof t){for(var e=0;e<this.elems.length;e++)t(this.elems[e],e);return this}},t.prototype.find=function(t){var n=[];this.each(e=>{var o=e.querySelectorAll(t);o=Array.prototype.slice.call(o),n=n.concat(o)});var i=document.createDocumentFragment();return n.forEach(function(t){i.appendChild(t.cloneNode())}),o(e(n))},t.prototype.get=function(t){return t>this.elems.length-1||t<0?null:this.elems[t]},t.prototype.isEmpty=function(){return!this.elems.length},t.prototype.addClass=function(){return this.each(t=>t.classList.add(...arguments))},t.prototype.removeClass=function(){return this.each(t=>t.classList.remove(...arguments))},t.prototype.toggleClass=function(t){return this.each(e=>e.classList.toggle(t))},t.prototype.hasClass=function(t){for(var e=0;e<this.elems.length;e++)if(!this.elems[e].classList.contains(t))return!1;return!0},t.prototype.on=function(t,e){return this.each(o=>o.addEventListener(t,e)),this.events=this.events||{},this.events[t]=this.events[t]||[],this.events[t].push(e),this},t.prototype.off=function(t,e){let o=this;return e?this.each(o=>o.removeEventListener(t,e)):o.events[t]&&this.each(e=>{const n=o.events[t];for(let o of n)e.removeEventListener(t,o)}),o},t.prototype.remove=function(){return this.each(t=>{t.remove()}),this},t.prototype.off=function(t,e){return this.each(o=>o.removeEventListener(t,e))};var e=t=>{var e=document.createDocumentFragment();return t.forEach(function(t){e.appendChild(t.cloneNode())}),e.querySelectorAll("*")},o=function(e){return new t(e)};return o}();window.__ascf={capitalize:t=>t?t=t.charAt(0).toUpperCase()+t.slice(1):"",priceFormatter:t=>t?(t/=100,t=parseFloat(t).toFixed(2).toString().replace(".",",")+" €"):"",cleanJson:t=>t?t=t.replace(/\n/g," "):"",priceFormatterWithDiscount:(t,e)=>t?(t*=e=.01*(100-e),t=Math.round(100*(t+Number.EPSILON))/100,t=parseFloat(t).toFixed(2).toString().replace(".",",")+" €"):"",currencyFormatter:t=>t?("eur"===t&&(t="€"),"usd"===t&&(t="$"),"cad"===t&&(t="$CAD"),"chf"===t&&(t="CHF"),t):"",dateUnitFormatter:t=>t?("day"===t.toLowerCase()&&(t="jours"),"days"===t.toLowerCase()&&(t="jours"),"week"===t.toLowerCase()&&(t="semaines"),"weeks"===t.toLowerCase()&&(t="semaines"),"month"===t.toLowerCase()&&(t="mois"),"months"===t.toLowerCase()&&(t="mois"),"year"===t.toLowerCase()&&(t="années"),"years"===t.toLowerCase()&&(t="années"),t):"",toSingular:t=>t?t=t.substring(0,t.length-+(t.lastIndexOf("s")==t.length-1)):"",dateFormatterLong(t){var e=new Date(t),o=["Janvier","Février","Mars","Avril","Mai","Juin","Juillet","Août","Septembre","Octobre","Novembre","Décembre"][e.getMonth()],n=""+e.getDate(),i=e.getFullYear();return n.length<2&&(n="0"+n),t=n+" "+o+" "+i},dateTimeFormatter(t){var e="",o=new Date(t),n=""+o.getSeconds(),i=""+o.getMinutes(),r=""+o.getDate(),s=""+o.getHours(),a=""+(o.getMonth()+1),l=""+o.getFullYear();return a=(a.length<2?"0":"")+a,r=(r.length<2?"0":"")+r,general_config.date_format?t=general_config.date_format.replace("yyyy",l).replace("dd",r).replace("mm",a).replace("hh",s).replace("mm",i).replace("ss",n):e=o.toISOString(),e},formatMoney:function(t,e){"string"==typeof t&&(t=t.replace(".",""));var o="",n=/\{\{\s*(\w+)\s*\}\}/,i=e||this.money_formats;function r(t,e){return void 0===t?e:t}function s(t,e,o,n){if(e=r(e,2),o=r(o,","),n=r(n,"."),isNaN(t)||null==t)return 0;var i=(t=(t/100).toFixed(e)).split(".");return i[0].replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1"+o)+(i[1]?n+i[1]:"")}switch(i.match(n)[1]){case"default":o=s(t,2);break;case"without_trailing_zeros":o=s(t,0);break;case"with_comma_separator":o=s(t,2,".",",");break;case"without_trailing_zeros_with_comma_separator":o=s(t,0,".",",")}return i.replace(n,o)},replace:function(t,e,o){return t.replace(e,o)}};var productsList={},shopifyProduct=new function(){function t(t){this.handle=t,productsList[this.handle]?this.product=productsList[this.handle]:this.update(this.handle)}return t.prototype.findVariantIdFromOptions=function(t){for(let e of this.product.variants){if(t.join(",").toLowerCase()==e.options.join(",").toLowerCase())return e.id}return null},t.prototype.prepProduct=async function(t){for(let e=0;e<t.options.length;e++){let o=t.options[e];o.values=[];let n=o.position-1;for(let e of t.variants){let t=e.options[n];o.values.includes(t)||o.values.push(t)}}this.product=t,productsList[this.handle]=this.product},t.prototype.update=function(t){this.fetch(t,this.prepProduct.bind(this))},t.prototype.fetch=function(t,e){fetch(`/products/${t}.js`).then(t=>t.json()).then(e).catch(e=>console.error("Couldn't fetch product",{handle:t},e))},t},generic_cart_block=new function(){function t(t,e,o,n){this.money_formats=null,this.cart_dependant=n,this.cartManager=t,this.settings=e,this.block_id=toolBox.makeId(10,{prefix:"block_"}),this.is_rendered=!1,this.events_handlers=o}return t.prototype.getHtml=function(){console.log("Each block will have its own implementation of this function")},t.prototype.eventsHandler=function(t){let e=t?"on":"off";for(const t of this.events_handlers)ZDOM(t.$ele?t.$ele:`#${this.block_id}`)[e](t.event,t.handler.bind(this))},t.prototype.destroy=function(){this.on_destroy&&"function"==typeof this.on_destroy&&this.on_destroy(),this.is_rendered=!1,this.eventsHandler(!1),this.is_rendered&&ZDOM("#"+this.block_id).remove(),this.is_rendered=!1,this.block_id=void 0},t.prototype.markAsRendered=function(){this.on_rendered&&"function"==typeof this.on_rendered&&this.on_rendered(),this.eventsHandler(!0),this.is_rendered=!0},t.prototype.updateBlock=async function(){if(this.is_rendered){if(this.eventsHandler(!1),"function"==typeof this.customBlockUpdate)this.customBlockUpdate();else{var t=await this.getHtml(),e=document.getElementById(this.block_id),o=toolBox.htmlToElement(t);e.parentNode.replaceChild(o,e)}this.eventsHandler(!0)}},t};const ItemManager=new function(){function t(t,e,r,s,a){this.money_formats=null,this.itemsManager=r,this.cartManager=r.cartManager,this.options=e,this.key=t;let l=r.getItemByKey(this.key);this.productHandler=new shopifyProduct(l.handle),this.block_id=toolBox.makeId(10,{prefix:"line-item_"}),this.block_attributes=s.block_attributes.template,this.quantity_template=s.quantity.template,this.remove_template=s.remove.template,this.injections_data={};for(let t in s){let e=s[t];this.injections_data={...e.template_data,...this.injections_data}}let c=[{event:"swiping-left",handler:n.bind(this)},{event:"swiping-right",handler:o.bind(this)},{event:"swiped-left",handler:n.bind(this)},{event:"swiped-right",handler:o.bind(this)},{event:"swipe-canceled",handler:i.bind(this)}];this.events_handlers=Array.isArray(a)?a.concat(c):c}function e(t,e,o){if(!t.target)return;let n=t.detail.xStart,r=t.detail.xEnd,s=Math.abs(r-n);var a=Math.min(Math.round(s/40),4),l=ZDOM(`#${this.block_id}`);l.hasClass("swiping-distance-4")&&l.hasClass(o)||(l.removeClass(e,"swiping-distance-1","swiping-distance-2","swiping-distance-3","swiping-distance-4"),l.addClass("swiping",o,`swiping-distance-${a}`),function(){this.cleanSwipingID&&clearTimeout(this.cleanSwipingID);this.cleanSwipingID=setTimeout(i.bind(this),400)}.bind(this)())}function o(t){e.bind(this)(t,"swiping--left","swiping--right")}function n(t){e.bind(this)(t,"swiping--right","swiping--left")}function i(t){var e=ZDOM(`#${this.block_id}`);e.hasClass("swiping-distance-4")||e.removeClass("swiping","swiping--left","swiping--right","swiping-distance-1","swiping-distance-2","swiping-distance-3","swiping-distance-4")}return t.prototype.eventsHandler=function(t){var e=!0===t?"on":"off";for(const t of this.events_handlers)ZDOM(t.$ele?t.$ele:`#${this.block_id}`)[e](t.event,t.handler.bind(this))},t.prototype.getGroupHeadingHtml=function(){console.log("item.getTitleHtml should be implemented by each extender")},t.prototype.getItemHtml=function(){console.log("item.getItemHtml should be implemented by each extender")},t.prototype.markAsRendered=function(){this.eventsHandler(!0),this.is_rendered=!0},t.prototype.destroy=function(){this.is_rendered&&(this.on_destroy&&"function"==typeof this.on_destroy&&this.on_destroy(),this.eventsHandler(!1),ZDOM("#"+this.block_id).remove(),this.block_id=void 0)},t.prototype.handleError=function(t){},t.is=function(t,e){return console.log("item.is should be implemented by each extender"),-1},t};var item_types=item_types||{};item_types.basic=new function(){function t(t,e,o,n){ItemManager.call(this,t,e,o,n,[])}return toolBox.inheritPrototype(t,ItemManager),t.prototype.getHtml=function(){let t=this.itemsManager.getItemByKey(this.key),e={id:this.block_id,money_formats:this.money_formats,options:this.options,line_item:t,...this.injections_data};return toolBox.renderTemplate(this.cartManager.templatesSelectors.basic_item,e,{block_attributes:this.block_attributes,quantity_template:this.quantity_template,remove_template:this.remove_template})},t.is=function(t,e){return 1},t};var item_types=item_types||{};item_types.native_subscription=new function(){function t(t,e,o,n){ItemManager.call(this,t,e,o,n,[])}return toolBox.inheritPrototype(t,ItemManager),t.prototype.getHtml=function(){return"Native subscription Item"},t.is=function(t,e){return-1},t};var item_types=item_types||{};item_types.native_recharge=new function(){function t(t,e,o,n){ItemManager.call(this,t,e,o,n,[])}return toolBox.inheritPrototype(t,ItemManager),t.prototype.getHtml=function(){return"Native recharge Item"},t.is=function(t,e){return-1},t};var item_types=item_types||{};item_types.non_native_recharge=new function(){function t(t,e,o,n){ItemManager.call(this,t,e,o,n,[])}return toolBox.inheritPrototype(t,ItemManager),t.prototype.getHtml=function(){let t=this.itemsManager.getItemByKey(this.key),e={id:this.block_id,money_formats:this.money_formats,options:this.options,line_item:t,...this.injections_data};return toolBox.renderTemplate(this.cartManager.templatesSelectors.non_native_recharge,e,{block_attributes:this.block_attributes,quantity_template:this.quantity_template,remove_template:this.remove_template})},t.is=function(t,e){return t.properties&&"subscription_id"in t.properties?10:-1},t};var item_types=item_types||{};item_types.item_adder=new function(){function t(t,e){ItemManager.call(this,t,e)}return t.prototype.getHtml=function(){return"Native subscription item"},t.is=function(t,e){return-1},toolBox.inheritPrototype(t,ItemManager),t};var item_types=item_types||{};item_types.reward=new function(){function t(t,e,o,n){ItemManager.call(this,t,e,o,n,[])}return toolBox.inheritPrototype(t,ItemManager),t.prototype.getHtml=function(){let t=this.itemsManager.getItemByKey(this.key),e={id:this.block_id,money_formats:this.money_formats,options:this.options,line_item:t,...this.injections_data};return toolBox.renderTemplate(this.cartManager.templatesSelectors.reward_item,e,{block_attributes:this.block_attributes,quantity_template:this.quantity_template,remove_template:this.remove_template})},t.is=function(t,e){return block_type&&block_type.rewards&&block_type.rewards.isRewardItem(t,t.variant_id)?1e5:-1},t};var item_types=item_types||{};item_types.featured_upsell=new function(){function t(t,e,o,n){ItemManager.call(this,t,e,o,n,[])}return toolBox.inheritPrototype(t,ItemManager),t.prototype.getHtml=function(){let t=this.itemsManager.getItemByKey(this.key),e={id:this.block_id,money_formats:this.money_formats,options:this.options,line_item:t,...this.injections_data};return toolBox.renderTemplate(this.cartManager.templatesSelectors.featured_upsell_item,e,{block_attributes:this.block_attributes,quantity_template:this.quantity_template,remove_template:this.remove_template})},t.is=function(t,e){return block_type&&block_type.rewards&&block_type.featured_upsell.isFeaturedUpsell(t)?1e5:-1},t};var block_type=block_type||{};block_type.header=new function(){var t;function e(e,o){generic_cart_block.call(this,e,o,[],!0),t=this}return toolBox.inheritPrototype(e,generic_cart_block),e.prototype.getHtml=function(){let e=t.cartManager.getCopyOfCart(),o={id:t.block_id,money_formats:t.money_formats,cart_count:e.item_count,display_cart_count:t.settings.configurations.display_cart_count,header_fixed:t.settings.configurations.header_fixed,title_position:t.settings.configurations.title_position,title:t.settings.configurations.title,button_close_display:t.settings.configurations.button_close_display};return toolBox.renderTemplate(t.cartManager.templatesSelectors.header,o)},e};var block_type=block_type||{};block_type.footer=new function(){var t;function e(e,o){generic_cart_block.call(this,e,o,[],!0),t=this}toolBox.inheritPrototype(e,generic_cart_block),e.prototype.getHtml=function(){let e=t.cartManager.getCopyOfCart(),n=o(t.settings,e),i="";if(n.summary){i=new block_type.summary(t.cartManager,n.summary).getHtml()}return toolBox.renderTemplate(t.cartManager.templatesSelectors.footer,n,{summary_template:i})};const o=function(e,o){var n={id:t.block_id,money_formats:t.money_formats,isFixed:e.configurations.footer_fixed,cartIsEmpty:0==o.item_count,cart:!1,checkout:!1,summary:!1,tos:!1};for(let t of e.block_level_options){const e=toolBox.getProp(t,"settings",{}),r=toolBox.getProp(e,"enabled",!1),s=t.option;if(r&&s)switch(s){case"cart":if(!e.label)break;var i={label:e.label};e.display_total&&(i.total=o.total_price),n.cart=i;break;case"checkout":if(!e.label)break;i={label:e.label};e.display_total&&(i.total=o.total_price),n.checkout=i;break;case"summary":n.summary={configurations:e};break;case"tos":i={title:e.title,content:e.content};e.number_of_visible_lines>0&&(i.number_of_visible_lines=e.number_of_visible_lines),n.tos=i;break;case"ps":i={content:e.content};n.ps=i}}return n};return e};var block_type=block_type||{};block_type.items=new function(){var t,e=[],o={};const n={item_root:"data-item-root",item_quantity_action:"scz-cart-item-quantity-action"},i={item_root:`[${n.item_root}]`,item_quantity_action:`[${n.item_quantity_action}]`};function r(e,n){const i=[{event:"click",handler:s},{event:"input",handler:a}];generic_cart_block.call(this,e,n,i,!0),t=this;for(let e of t.settings.item_level_options){let t=e.type,n=e.hidden,i=toolBox.getProp(e,"settings.grouping",{});!0!==n&&!0===i.enabled&&t&&(o[t]=i)}}function s(t){var e=t.target;if(e){var o=e.closest(i.item_quantity_action);if(o){var r=o.closest(i.item_root);if(r){var s={};try{s=JSON.parse(r.getAttribute(n.item_root))}catch(t){return}var a=o.getAttribute(n.item_quantity_action),l=s.key;if(a&&l){if("-"==a)this.decreaseQuantity(l);else if("+"==a)this.increaseQuantity(l);else{if("0"!=a)return;this.removeItem(l)}t.stopPropagation()}}}}}function a(t){var e=t.target;if(e){var o=e.closest(i.item_quantity_action);if(o){var r=o.closest(i.item_root);if(r){var s={};try{s=JSON.parse(r.getAttribute(n.item_root))}catch(t){return}var a=o.getAttribute(n.item_quantity_action),l=s.key;a&&l&&("select"!=o.tagName.toLowerCase()&&"input"!=o.tagName.toLowerCase()||(this.cartManager.updateItems([{type:this.cartManager.CART_REQUEST_TYPES.UPDATE,items:[{key:l,quantity:o.value}]}]),t.stopPropagation()))}}}}return toolBox.inheritPrototype(r,generic_cart_block),r.prototype.getHtml=async function(){let n=t.cartManager.getCopyOfCart(),i=(e=t.initCartItems()).reduce((t,e)=>{let n=o[e.type],i=n?e.type:"non_grouped";return t[i]||(t[i]={options:n,items:[]}),t[i].items.push(e),t},{}),r="";for(let e in i){let o=i[e].options,n=i[e].items;r+=`\x3c!-- items group : ${e} --\x3e`,r+="<div>",o&&(r+=`\n        <div>\n          <p class="scz-cart-items-group-title">${o.title}</p>\n          ${o.subtitle?`<p class="scz-cart-items-group-subtitle">${o.subtitle}</p>`:""}\n        </div>\n      `);for(let e of n)try{r+=e.getHtml()}catch(o){let n=t.getItemByKey(e.key);console.error("Couldn't render item",e,o),r+=`<div><center>${n.title} failed to display correctly</center></div>`}r+="</div>"}let s={id:t.block_id,item_count:n.item_count,items_html:r};return toolBox.renderTemplate(t.cartManager.templatesSelectors.items,s)},r.prototype.on_destroy=function(){for(let t of e)t.destroy()},r.prototype.on_rendered=function(){for(let t of e)t.markAsRendered()},r.prototype.getQuantityTemplate=function(t,e){try{toolBox.getProp(t,"quantity.updatable",!1);const i={ACTIONS:{LABEL:"actions",TEMPLATE_ID:"#scz-cart-item-quantity-actions"},DROPDOWN:{LABEL:"dropdown",TEMPLATE_ID:"#scz-cart-item-quantity-dropdown"},NONE:{LABEL:"none",TEMPLATE_ID:""}};let r=toolBox.getProp(this.settings,"configurations.quantity",{style:"actions",limit_max:10});for(const t in i){let s=i[t];if(s.LABEL==r.style){var o=ZDOM(s.TEMPLATE_ID);if(o.isEmpty())throw new Error("Template is empty");var n={...r.metadata};return n.quantity_values=function(){let t=[],o=Math.max(r.limit_max,e.quantity);for(let e=0;e<=o;e++)t.push(e);return t}(),{template:o.get(0).innerHTML,template_data:n}}}}catch(t){console.error("Couldn't find a template for quantity",t)}return{template:"",template_data:{}}},r.prototype.getRemoveTemplate=function(t,e){try{if(!toolBox.getProp(t,"remove.enabled",!1))throw new Error("Remove action is not available for this line item");const e={ONLY_TEXT:{LABEL:"only_text",TEMPLATE_ID:"#scz-cart-remove-item-only-text"},ONLY_ICON:{LABEL:"only_icon",TEMPLATE_ID:"#scz-cart-remove-item-only-icon"},BOTH:{LABEL:"both",TEMPLATE_ID:"#scz-cart-remove-item-both"},NONE:{LABEL:"none",TEMPLATE_ID:""}};let i=toolBox.getProp(this.settings,"configurations.remove",{layout:"both",label:"remove",icon:""});for(const t in e){let r=e[t];if(r.LABEL==i.style){var o=ZDOM(r.TEMPLATE_ID),n={remove_label:i.label,remove_icon:i.icon};if(o.isEmpty())throw new Error("Template is empty or not found",r);return{template:o.get(0).innerHTML,template_data:n}}}}catch(t){console.error("Couldn't fetch remove item template",t)}return{template:"",template_data:{}}},r.prototype.initCartItems=function(){let e=t.cartManager.getCopyOfCart(),o=t.settings;var i=[];for(let t of e.items){let e=[];for(let n in item_types){let i=-1;try{i=item_types[n].is(t)}catch(e){console.error("Couldn't verify if line item is an itemType",e,{line_item:t,itemType:n})}if(i<0)continue;let r=o.item_level_options.find(t=>t.type==n);e.push({type:n,score:i,class:item_types[n],options:r.settings,hidden:r.hidden})}if(e.sort((t,e)=>t.score>e.score?-1:e.score<t.score?1:0),!e.length)return;let r=e.shift(),s={block_attributes:{template:`\n            ${n.item_root}='{\n              "type"     : "${r.type}",\n              "key"      : "${t.key}",\n              "quantity" : ${t.quantity}\n            }'\n          `,template_data:{}},quantity:this.getQuantityTemplate(r.options,t),remove:this.getRemoveTemplate(r.options,t)},a=r.options.remove||{};if(a.enable_swiping_on_mobile=toolBox.getProp(o,"configurations.remove.enable_swiping_on_mobile",!1),r.options.remove=a,r.options.link_product=toolBox.getProp(o,"configurations.link_product",{}),r.hidden)continue;let l=new r.class(t.key,r.options,this,s);l.money_formats=this.money_formats,l.type=r.type,i.push(l)}return i},r.prototype.increaseQuantity=function(t){const e=this.getItemByKey(t);return!e||isNaN(e.quantity)?console.error(`Couldn't find a matching item for key: ${t}`):this.cartManager.updateItems([{type:this.cartManager.CART_REQUEST_TYPES.UPDATE,items:[{key:t,quantity:++e.quantity}]}])},r.prototype.decreaseQuantity=function(t){const e=this.getItemByKey(t);return!e||isNaN(e.quantity)?console.error(`Couldn't find a matching item for key: ${t}`):this.cartManager.updateItems([{type:this.cartManager.CART_REQUEST_TYPES.UPDATE,items:[{key:t,quantity:--e.quantity}]}])},r.prototype.removeItem=function(t){return this.cartManager.updateItems([{type:cartManager.CART_REQUEST_TYPES.REMOVE,items:[{key:t,quantity:0}]}])},r.prototype.updateProperties=function(t,e){return this.cartManager.updateItems([{type:this.cartManager.CART_REQUEST_TYPES.UPDATE,items:[{key:t,properties:e}]}])},r.prototype.getItemByKey=function(t){return this.cartManager.getCopyOfCart().items.find(e=>e.key==t)},r.prototype.getItemById=function(t){return this.cartManager.getCopyOfCart().items.find(e=>e.id==t)},r};var block_type=block_type||{};block_type.richtext=new function(){function t(t,e){generic_cart_block.call(this,t,e,[],!1)}return toolBox.inheritPrototype(t,generic_cart_block),t.prototype.getHtml=function(){let t={id:this.block_id,settings:this.settings,money_formats:self.money_formats};return toolBox.renderTemplate(this.cartManager.templatesSelectors.richtext,t)},t};var block_type=block_type||{};block_type.accordion=new function(){var t,e="scz-accordion-title-tab",o="scz-cart-accordion-title--active",n="scz-cart-accordion-content--open",i="scz-cart-accordion-content--closed",r={title_tab:`[${e}]`,content_tab:`[${"scz-accordion-content"}]`,active_title:`.${o}`,open_content:`.${n}`,closed_content:`.${i}`},s={panels:[{title:"Tab1 title",description:"Tab1 content"},{title:"Tab2 title",description:"Tab2 content"}],configurations:{allow_multiple_active_tabs:!0,display_icon:!0,icon:"plus"}};function a(e,o){t=this;var n=[{event:"click",handler:l}];generic_cart_block.call(this,e,o,n,!1),t.settings=toolBox.merge(s,o,!0)}toolBox.inheritPrototype(a,generic_cart_block),a.prototype.getHtml=function(){let e={id:this.block_id,money_formats:this.money_formats,panels:this.settings.panels,display_icon:this.settings.configurations.display_icon,icon:this.settings.configurations.icon};return toolBox.renderTemplate(t.cartManager.templatesSelectors.accordion,e)};var l=s=>{var a=ZDOM(s.target);if(a.isEmpty())return;var l=ZDOM(a.get(0).closest(r.title_tab));if(l.isEmpty())return;var c=l.get(0).getAttribute(e),p=ZDOM("#"+c);if(p.isEmpty())return;var u=ZDOM("#"+t.block_id),d=!l.hasClass(o);let m=Date.now();this.lockTimestamp=this.lockTimestamp||m,m-this.lockTimestamp>0&&m-this.lockTimestamp<300||(m-this.lockTimestamp>300&&(this.lockTimestamp=null),d?(t.settings.configurations.allow_multiple_active_tabs||u.find(r.title_tab).removeClass(o),l.addClass(o),t.settings.configurations.allow_multiple_active_tabs||u.find(r.content_tab).removeClass(n).addClass(i),p.removeClass(i).addClass(n)):(l.removeClass(o),p.removeClass(n).addClass(i)),s.preventDefault(),s.stopPropagation())};return a};var block_type=block_type||{};block_type.rewards=new function(){const t="product",e="[scz-cart-rewards--current-message]",o="[scz-cart-rewards--next-message]",n="[scz-cart-rewards--progress-bar]";let i=null,r=null;function s(t,e){generic_cart_block.call(this,t,e,[],!0),this.enabled=toolBox.getProp(e,"configurations.enabled",!1),this.rewards=toolBox.getProp(e,"configurations.steps",[]),this.rewards.sort((t,e)=>isNaN(t.threshold)&&isNaN(e.threshold)||t.threshold==e.threshold?0:!isNaN(t.threshold)&&isNaN(e.threshold)||t.threshold>e.threshold?1:!isNaN(e.threshold)&&isNaN(t.threshold)||e.threshold>t.threshold?-1:0);for(var o=0;o<this.rewards.length;o++){let t=this.rewards[o];t.unlocked=!1,t.last_unlocked=!1,t.next_to_unlock=0===o}}function a(t){return{name:`_reward_${t}`,value:"unlocked"}}return toolBox.inheritPrototype(s,generic_cart_block),s.prototype.getHtml=function(){if(!this.enabled)return"";let t=this.cartManager.getCopyOfCart();this.updateReward(t);let e=this.generateRenderOptions(t);return toolBox.renderTemplate(this.cartManager.templatesSelectors.rewards,e)},s.prototype.customBlockUpdate=function(){if(!this.enabled)return;let t=this.cartManager.getCopyOfCart();this.updateReward(t),document.getElementById(this.block_id).querySelector(e),document.getElementById(this.block_id).querySelector(o),document.getElementById(this.block_id).querySelector(n)},s.prototype.generateRenderOptions=function(t){return{id:this.block_id,money_formats:this.money_formats,rewards:this.rewards,cart:t}},s.prototype.updateReward=function(t){var e=this.calculateRealSubtotal(t);let o=null,n=null;for(let t of this.rewards)if(!toolBox.isEmpty(t)&&e>=t.threshold)o=t,t.unlocked=!0,t.last_unlocked=!1,t.next_to_unlock=!1;else{t.unlocked=!1,t.last_unlocked=!1;var s=!n&&!toolBox.isEmpty(t)&&e<t.threshold;t.next_to_unlock=s,s&&(n=t)}o&&(o.last_unlocked=!0),this.updateProductRewards(t,this.rewards,o,o),toolBox.isEmpty(o)&&toolBox.isEmpty(i)||toolBox.isEmpty(i)||o.threshold>i.threshold||(toolBox.isEmpty(o)||o.threshold<i.threshold)&&i.type,i=o,r=n},s.prototype.calculateRealSubtotal=function(t){let e=t.items_subtotal_price;for(let o of t.items){let t=a(o.variant_id);toolBox.hasAttribute(o,t)&&(e-=o.original_price)}return e},s.prototype.updateProductRewards=function(e,o){const n=e.items.filter(t=>{let e=a(t.variant_id);if(!t.properties)return!1;let o=JSON.parse(JSON.stringify(t.properties));Array.isArray(o)||(o=[o]);for(let t of o)if(t.name==e.name&&t.value==e.value)return!0;return!1});const i=o.filter(e=>e.unlocked&&e.type==t&&e.variant_id);let r=[],s=[];for(let t of i){let e=!1;for(let t of n){let o=a(t.variant_id);if(toolBox.hasAttribute(t,o)){e=!0;break}}e||r.push(t)}for(let t of n){let e=!1;for(let o of i){let n=a(o.variant_id);if(toolBox.hasAttribute(t,n)){e=!0;break}}e||s.push(t)}let l=[],c=[];for(let t of r)l.push({id:t.variant_id,quantity:1,properties:a(t.variant_id)});for(let t of s)c.push({key:t.key});let p=[];l.length&&p.push({type:this.cartManager.CART_REQUEST_TYPES.ADD,items:l}),c.length&&p.push({type:this.cartManager.CART_REQUEST_TYPES.REMOVE,items:c}),p.length&&this.cartManager.updateItems(p)},s.isRewardItem=function(t,e){let o=a(e);return toolBox.hasAttribute(t,o)},s};var block_type=block_type||{};block_type.upsell=new function(){function t(t,e){generic_cart_block.call(this,t,e,[],!0),this.title=toolBox.getProp(e,"configurations.title",""),this.search_term=toolBox.getProp(e,"configurations.search_term",""),this.style=toolBox.getProp(e,"configurations.style","slider"),this.products_per_row=Math.max(toolBox.getProp(e,"configurations.products_per_row",0),1),this.max_rows=Math.max(toolBox.getProp(e,"configurations.max_rows",0),1),this.max_products=Math.max(toolBox.getProp(e,"configurations.max_products",0),1),this.hide_products_in_cart=toolBox.getProp(e,"configurations.hide_products_in_cart",!0),this.vaultKey="upsell-"+this.search_term,this.products=this.cartManager.getFromVault(this.vaultKey),this.products||fetch(`/search/suggest.json?q=${this.search_term}&resources[type]=product`).then(t=>t.json()).then(this.handleProducts.bind(this))}return toolBox.inheritPrototype(t,generic_cart_block),t.prototype.getHtml=function(){let t=self.cartManager.getCopyOfCart(),e=[];for(var o of this.products){!!t.items.find(t=>t.product_id==o.id)&&this.hide_products_in_cart||!(this.max_products>e.length)||e.push(o)}let n="slider"==this.style&&e.length>1;var i={id:this.block_id,money_format:this.money_formats,is_slider:n,title:this.title,max_rows:n?1:this.max_rows,products_per_row:n?this.max_rows*this.products_per_row:this.products_per_row,products:e};return toolBox.renderTemplate(self.cartManager.templatesSelectors.upsell,i,{})},t.prototype.handleProducts=function(t){let e=toolBox.getProp(t,"resources.results.products",[]);e||(e=[]),this.cartManager.addToVault(this.vaultKey,e),this.products=e},t};var block_type=block_type||{};block_type.spacer=new function(){function t(t,e){generic_cart_block.call(this,t,e,[],!1)}return toolBox.inheritPrototype(t,generic_cart_block),t.prototype.getHtml=function(){let t={id:this.block_id,money_formats:self.money_formats,spacing:this.settings.configurations.spacing};return toolBox.renderTemplate(this.cartManager.templatesSelectors.spacer,t)},t};var block_type=block_type||{};block_type.image=new function(){function t(t,e){generic_cart_block.call(this,t,e,[],!1)}return toolBox.inheritPrototype(t,generic_cart_block),t.prototype.getHtml=function(){let t={id:this.block_id,money_formats:this.money_formats,src:this.settings.configurations.src,nature:this.settings.configurations.nature,crop:this.settings.configurations.crop,full_width:this.settings.configurations.full_width};return toolBox.renderTemplate(this.cartManager.templatesSelectors.image,t)},t};var block_type=block_type||{};block_type.summary=new function(){var t={input:"[scz-add-address]"};function e(t,e){var o=[{event:"click",handler:n.bind(this)}];this.popupSettings=null,generic_cart_block.call(this,t,e,o,!0)}toolBox.inheritPrototype(e,generic_cart_block),e.prototype.getHtml=function(){let t=this.cartManager.getCopyOfCart(),e=o.bind(this)(this.settings,t);return this.address=this.cartManager.getFromVault("adress"),toolBox.renderTemplate(this.cartManager.templatesSelectors.summary,e)};const o=function(t,e){var o=t.configurations,n={id:this.block_id,money_formats:this.money_formats,cartIsEmpty:0==e.item_count},i={};if(o.title_line&&o.title_line.enabled&&(i.title={label:o.title_line.label,isCollapsible:1==o.collapsible,isOpenDefault:!o.collapsible||0!=o.open_default}),o.subtotal_line&&o.subtotal_line.enabled&&(i.subtotal={label:o.subtotal_line.label,value:e.items_subtotal_price}),o.discounts_line&&o.discounts_line.enabled&&(i.discounts={label:o.discounts_line.label,value:e.total_discount}),o.shipping_line&&o.shipping_line.enabled&&(i.shipping={label:o.shipping_line.label,value:o.shipping_line.value},o.shipping_line.button_add_address&&null==this.address&&(i.shipping.button_add_address=o.shipping_line.button_add_address)),o.total_line&&o.total_line.enabled)if(o.total_line.display_cart_count)var r=o.total_line.label+" ( "+e.item_count+o.total_line.cart_count_prefix+" ) ";else r=o.total_line.label;if(i.total={label:r,value:e.total_price},o.weight_line&&o.weight_line.enabled&&(i.weight={label:o.weight_line.label,value:e.total_weight}),null!=t.block_level_options)for(let e of t.block_level_options){const t=toolBox.getProp(e,"settings",{}),o=toolBox.getProp(t,"enabled",!1),n=e.option;if(o&&n)switch(n){case"add_address":var s={};t.title_line&&t.title_line.enabled&&(s.title={label:t.title_line.label}),t.subtotal_line&&t.subtotal_line.enabled&&(s.subtotal={label:t.subtotal_line.label}),t.inputs&&t.inputs.enabled&&(s.form=t.inputs),this.popupSettings=s}}return n.summary=i,n};function n(e){var o=document.getElementById(this.block_id);if(o){o.querySelector(t.input);this.cartManager.openPopup(this.popupSettings)}}return e};var block_type=block_type||{};block_type.button=new function(){var t;function e(e,o){generic_cart_block.call(this,e,o,[],!0),t=this}return toolBox.inheritPrototype(e,generic_cart_block),e.prototype.getHtml=function(){let e=generateRenderOptions();return toolBox.renderTemplate(t.cartManager.templatesSelectors.button,e)},e.prototype.generateRenderOptions=(()=>{let e=this.settings,o=t.cartManager.getCopyOfCart();return{id:this.block_id,money_formats:this.money_formats,cartIsEmpty:0==o.item_count,title:e.configurations.title,url:e.configurations.url,width:e.configurations.width,button_align:e.configurations.button_align,active_hover:e.configurations.active_hover,text_bold:e.configurations.text_bold,text_align:e.configurations.text_align}}),e};var block_type=block_type||{};block_type.icons=new function(){var t;function e(e,o){generic_cart_block.call(this,e,o,[],!0),t=this}toolBox.inheritPrototype(e,generic_cart_block),e.prototype.getHtml=function(){let e=t.cartManager.getCopyOfCart(),n=o(t.settings,e);return toolBox.renderTemplate(t.cartManager.templatesSelectors.icons,n)};const o=(e,o)=>{return{id:t.block_id,money_formats:t.money_formats,cartIsEmpty:0==o.item_count,numberPerRow:e.configurations.number_per_row,align:e.configurations.align,icons:t.settings.icons}};return e};var block_type=block_type||{};block_type.featured_upsell=new function(){var t="scz-featured-upsell-input",e={hide_input:"scz-featured-upsell--hide",loading:"scz-featured-upsell--loading"},o={input:`[${t}]`,hide_input:`.${e.hide_input}`,loading:`.${e.loading}`};function n(t,e){var o=[{event:"change",handler:r.bind(this)}];this.blocked=!1,generic_cart_block.call(this,t,e,o,!0),this.title=toolBox.getProp(e,"configurations.title",""),this.description=toolBox.getProp(e,"configurations.description",""),this.input_label=toolBox.getProp(e,"configurations.input_label",""),this.hide_if_selected=toolBox.getProp(e,"configurations.hide_if_selected",!1),this.variant_id=toolBox.getProp(e,"configurations.variant_id","")}function i(t){return{name:`_featured_upsell_${t}`,value:"unlocked"}}function r(t){if(!this.blocked){var n=document.getElementById(this.block_id);if(n){var r=n.querySelector(o.input),c=this.cartManager.getCopyOfCart(),p=i(this.variant_id),u=c.items.find(t=>toolBox.hasAttribute(t,p)),d=!!u;if(r.checked&&!d){this.toggleLoadingClass(),n.classList.remove(e.hide_input);let t={id:this.variant_id,quantity:1,properties:i(this.variant_id)};this.cartManager.postShopify(t,this.cartManager.CART_REQUEST_TYPES.ADD,{onSuccess:s.bind(this),onFailure:s.bind(this),always:l.bind(this)})}else if(!r.checked&&d){this.toggleLoadingClass(),this.hide_if_selected&&n.classList.add(e.hide_input);let t={id:u.key,quantity:0};this.cartManager.postShopify(t,this.cartManager.CART_REQUEST_TYPES.CHANGE,{onSuccess:a.bind(this),onFailure:s.bind(this),always:l.bind(this)})}}}}function s(){this.blocked=!1}function a(){this.blocked=!1}function l(){this.toggleLoadingClass()}return toolBox.inheritPrototype(n,generic_cart_block),n.prototype.getHtml=function(){var e=this.cartManager.getCopyOfCart(),o=i(this.variant_id),n=e.items.find(t=>toolBox.hasAttribute(t,o));let r={id:this.block_id,money_formats:this.money_formats,title:this.title,description:this.description,input_label:this.input_label,input_attr:t,is_checked:!!n};return toolBox.renderTemplate(this.cartManager.templatesSelectors.featured_upsell,r)},n.prototype.customBlockUpdate=function(){this.toggleHideClass(),r.bind(this)()},n.prototype.on_rendered=function(){r.bind(this)()},n.prototype.toggleHideClass=function(){var t=this.cartManager.getCopyOfCart(),o=i(this.variant_id),n=t.items.find(t=>toolBox.hasAttribute(t,o));document.getElementById(this.block_id).classList[this.hide_if_selected&&n?"add":"remove"](e.hide_input)},n.prototype.toggleLoadingClass=function(){let t=document.getElementById(this.block_id).classList.contains(e.hide_input);document.getElementById(this.block_id).classList[t?"remove":"add"](e.loading),this.blocked=!t},n.isFeaturedUpsell=function(t){let e=i(t.variant_id);return toolBox.hasAttribute(t,e)},n};var block_type=block_type||{};const CartManager=new function(){let t=void 0,e=ZDOM;var o=[],n=void 0;const i="[scz-cart]",r="[scz-cart-trigger]",s="[scz-cart-close]",a="[scz-cart-overlay]",l="[scz-loader]",c="scz-cart-open",p="scz-overlay-active",u="scz-loader-active",m={container:"scz-cart-container",overlay:"scz-cart-overlay",header:"scz-cart-header",footer:"scz-cart-footer",content:"scz-cart-content",items:"scz-cart-items",basic_item:"scz-cart-basic_item",reward_item:"scz-cart-reward_item",featured_upsell_item:"scz-cart-featured_upsell_item",non_native_recharge:"scz-cart-non_native_recharge_item",richtext:"scz-cart-richtext",accordion:"scz-cart-accordion",rewards:"scz-cart-rewards",featured_upsell:"scz-cart-featured_upsell",spacer:"scz-cart-spacer",image:"scz-cart-image",summary:"scz-cart-summary",button:"scz-cart-button",spacer:"scz-cart-spacer",icons:"scz-cart-icons",upsell:"scz-cart-upsell",popup:"scz-cart-popup"},h="my_desktop_styles_id",f="my_mobile_styles_id";let _={enabled:!1,storage_key:"sz_cart_address",rates:null,address:null};const y={JSON:config_sidecart,CART:"/cart.js"};let g={};function b(){(t=this).templatesSelectors=m,t.CART_REQUEST_TYPES={ADD:"add",UPDATE:"update",CHANGE:"change",REMOVE:"remove",CLEAR:"clear"}}b.prototype.init=async function(){this.settings=await v(),n=await k(),this.root_dom_id=toolBox.makeId(10,{prefix:"cart_root_"}),document.querySelector("body").append(toolBox.htmlToElement(`\n        <div id="${this.root_dom_id}"></div>\n      `)),E.bind(this)(["/cart/add.js","/cart/update.js","/cart/change.js"],this.handleCartUpdates.bind(this)),this.handleEvents(),this.cartVisibilityState=!1,this.isUpdating=!1;var t=toolBox.getProp(Shopify,"currency.active","EUR"),e=`{{format}}${t}`;try{var o=Shopify.locale+"-"+Shopify.locale.toUpperCase(),i=new Intl.NumberFormat(o,{style:"currency",currency:t}).format(1),r=new Intl.NumberFormat(o,{style:"currency",currency:t}).formatToParts().find(t=>"currency"==t.type).value;e=i.split(r).map(t=>""!=t?"{{format}}":r).join("")}catch(t){console.error("Couldn't get money format, reverting to default: ",e)}this.money_formats={default:e.replace("format","default"),without_trailing_zeros:e.replace("format","without_trailing_zeros"),with_comma_separator:e.replace("format","with_comma_separator"),without_trailing_zeros_with_comma_separator:e.replace("format","without_trailing_zeros_with_comma_separator")},this.handlePlugins(),this.dryBlockInit()},b.prototype.destroy=function(){t.teardownBlocks(),t.teardownStyles(),document.getElementById(t.root_dom_id).innerHTML=""},b.prototype.teardownStyles=function(){var t=document.getElementById(h);t&&t.remove();var e=document.getElementById(f);e&&e.remove()},b.prototype.teardownBlocks=function(){for(const t of o)t.destroy();o=[]},b.prototype.handleEvents=function(){document.body.addEventListener("click",e=>{if(e.target&&!window.location.pathname.endsWith("/cart")){if(e.target.closest("a"))"/cart"==e.target.closest("a").getAttribute("href")&&(t.updateCartVisibilityState(!0),e.stopPropagation(),e.preventDefault());e.target.closest(r)&&(t.updateCartVisibilityState(!0),e.stopPropagation())}},!1),document.getElementById(t.root_dom_id).addEventListener("click",function(e){e.target&&e.target.matches(s)&&t.updateCartVisibilityState(!1)},!1);const e=toolBox.getProp(t.settings,"section.close",{});e&&e.on_outside_click&&document.body.addEventListener("click",function(e){e.target&&!e.target.closest(`.${m.container}`)&&t.updateCartVisibilityState(!1)},!1)},b.prototype.updateCartVisibilityState=async function(o){if(t.cartVisibilityState==o)return n=await k(),void this.notifyCartDependents();o?(await t.renderCart(t.settings.blocks),e(i).addClass(c),e(a).addClass(p)):(e(i).removeClass(c),e(a).removeClass(p),t.destroy()),t.cartVisibilityState=o},b.prototype.updateLoaderVisibilityState=function(t){this.isUpdating!=t&&(t?e(l).addClass(u):e(l).removeClass(u),this.isUpdating=t)},b.prototype.addToVault=function(t,e){g[t]=e},b.prototype.getFromVault=function(t){return g[t]},b.prototype.updateNote=async function(t){const e={note:t};await this.postShopify.bind(this)(e,"update")},b.prototype.initBlocks=function(){this.teardownBlocks();const e=this.settings.blocks;for(let n of e)try{let e=new block_type[n.block_type](t,n);e.money_formats=this.money_formats,o.push(e)}catch(t){console.error(`Couldn't create an instance of block ${n.block_type}`,t)}},b.prototype.dryBlockInit=function(){this.initBlocks(),this.teardownBlocks()},b.prototype.initAssets=function(){t.teardownStyles(),toolBox.loadStyles({id:h,object:{":root":toolBox.getProp(this,"settings.root_var",{})}}),toolBox.loadStyles({id:f,max_width:"600px",object:{}})},b.prototype.renderCart=async function(){t.initBlocks(),t.initAssets(),t.section_id=toolBox.makeId(5,{prefix:"side_cart_container_"}),t.section_type="side_cart",n=await k();let e={layout:t.settings.layout};const o=toolBox.renderTemplate(t.templatesSelectors.container,e);t.template=`<section id="${t.section_id}" section-type="${t.section_type}"><div class="scz-cart-container-arrow-up"></div>${o}</section>`,document.getElementById(t.root_dom_id).insertAdjacentHTML("beforeend",t.template);const i=toolBox.getProp(t.settings,"section.overlay",{});if(i&&i.enabled){const e={opacity:i.opacity},o=toolBox.renderTemplate(t.templatesSelectors.overlay,e);document.getElementById(t.root_dom_id).insertAdjacentHTML("beforeend",o)}await t.renderBlocks()},b.prototype.renderBlocks=async function(){for(const e of o){const o=toolBox.getProp(e,"settings.configurations.scope",1);if(1==o&&0!=n.item_count)continue;if(2==o&&0==n.item_count)continue;let i="";try{i=await e.getHtml()}catch(t){console.error("Error rendering block",{block:e},t);continue}let r=toolBox.htmlToElement(i);document.getElementById(t.section_id).getElementsByClassName(t.templatesSelectors.container)[0].append(r);try{e.markAsRendered()}catch(t){console.error("Error marking block as rendered",{block:e},t)}}},b.prototype.reload=async function(){t.initBlocks(),t.initAssets(),document.getElementById(t.section_id).getElementsByClassName(t.templatesSelectors.container)[0].innerHTML="",await t.renderBlocks()},b.prototype.notifyCartDependents=async function(t){const e=async function(){for(const t of o)t.cart_dependant&&await t.updateBlock()};!0===t?k(!0).then(async t=>{n=t,await e()}):await e()},b.prototype.handlePlugins=(()=>{if(toolBox.isEmpty(window.alfred_side_cart_plugins))return;let e=window.alfred_side_cart_plugins,o=toolBox.getProp(e,"blocks",[]);if(!Array.isArray(o)||!o.length)return;o.sort((t,e)=>isNaN(t.order)&&isNaN(e.order)||t.order==e.order?0:!isNaN(t.order)&&isNaN(e.order)||t.order>e.order?1:!isNaN(e.order)&&isNaN(t.order)||e.order>t.order?-1:0);let n=[],i={},r={};for(const e of t.settings.blocks)"header"==e.block_type?i=e:"footer"==e.block_type&&(r=e),n.push(e);for(const t of o){var{order:s,_class:a,config:l}=t;if(!toolBox.isEmpty(a)&&!toolBox.isEmpty(l)){if("header"==l.block_type)i=l;else if("footer"==l.block_type)r=l;else{if("items"==l.block_type)continue;s&&s>0&&s<n.length?n.splice(s-1,0,l):n.push(l)}block_type[l.block_type]=a}}toolBox.isEmpty(i)||n.unshift(i),toolBox.isEmpty(r)||n.push(r);let c=toolBox.getProp(e,"items",[]);for(const t of c){var{order:s,_class:a,config:l}=t;toolBox.isEmpty(a)||toolBox.isEmpty(l)||"basic"!=l.block_type&&(item_types[l.block_type]=a)}}),b.prototype.handleErrors=function(t){return console.log(t),t.status+" "+t.message+" "+t.description},b.prototype.handleCartUpdates=function(t,e){let o=this.getCopyOfCart(),n=this.updateLocalCartObject(t),i=this.getCopyOfCart(),r=toolBox.getProp(this.settings,"section.open.on_cart_update",!1);!this.cartVisibilityState&&r&&i.item_count&&i.item_count>o.item_count?this.updateCartVisibilityState(!0):this.cartVisibilityState&&(0==o.item_count&&i.item_count>0||o.item_count>0&&0==i.item_count||n)?this.reload():this.cartVisibilityState&&this.notifyCartDependents();let s={request:new URL(e).pathname.replace(/(\/cart\/)([\D]*)\.js/,function(t,e,o,n){return o}),item_count:i.item_count,cart:i};document.body.dispatchEvent(new CustomEvent("cart:update",{bubbles:!0,cancelable:!0,detail:s}))},b.prototype.getCopyOfCart=function(){var t=JSON.parse(JSON.stringify(n));return t.total_price_variations||(t.total_price_variations={}),t},b.prototype.updateLocalCartObject=function(t){try{var e=!1;if(!Array.isArray(t.items)&&"object"==typeof t&&t.key){var o=[t];(t={items:[]}).items=o}else if(!Array.isArray(t.items)&&"object"!=typeof t.items&&!t.key)return console.error("ERROR - unable to update cart because input object is not valid",t);const r=["items"],s=["title","subtitle","featured_image","image"];if(t.token){for(let e in t){if(r.includes(e))continue;let o=t[e];n[e]=o}let e=[];for(let o of t.items){var i=n.items.find(t=>t.key==o.key);i&&e.push(i)}n.items=e}for(let o=0;o<t.items.length;o++){let i=t.items[o],r=n.items.findIndex(t=>t.key==i.key);if(r>-1)for(let t in i)s.includes(t)||(n.items[r][t]=i[t]);else n.items.unshift(i),e=!0}return n.original_total_price=n.items.reduce((t,e)=>parseInt(t.original_line_price||t)+parseInt(e.original_line_price),0),n.items_subtotal_price=n.items.reduce((t,e)=>parseInt(t.final_line_price||t)+parseInt(e.final_line_price),0),n.total_discount=n.items.reduce((t,e)=>parseInt(t.total_discount||t)+parseInt(e.total_discount),0),n.total_weight=n.items.reduce((t,e)=>parseInt(t.grams||t)+parseInt(e.grams),0),n.item_count=n.items.reduce((t,e)=>parseInt(t.quantity||t)+parseInt(e.quantity),0),n.total_price=n.items_subtotal_price,e}catch(t){console.error("Error updating local cart object using the intercepted response",t)}},b.prototype.addItem=async function(t,e,o){const n={items:[{id:t,quantity:e,properties:o}]};this.postShopify.bind(this)(n,"add")},b.prototype.replaceItem=function(t,e,o){let n=this.getItemByKey(t),i=this.getItemById(e),r={id:e};r.quantity=o.quantity||n.quantity,r.properties=o.properties||n.properties||{},r.selling_plan=o.selling_plan,toolBox.isEmpty(r.properties)&&toolBox.isEmpty(r.selling_plan)&&!i?this.updateItems({type:this.CART_REQUEST_TYPES.UPDATE,items:[{key:t,quantity:0},r]}):this.updateItems([{type:this.CART_REQUEST_TYPES.REMOVE,items:[{key:t}]},{type:this.CART_REQUEST_TYPES.ADD,items:[r]}])},b.prototype.updateItems=function(t,e){Array.isArray(t)||(t=[t]);let o=[],n={updates:{}},i={items:[]};for(let e of t){let t=e.type,r=e.items;if(t==this.CART_REQUEST_TYPES.ADD)for(let t of r){if(!t.id||isNaN(t.quantity)){console.error("To add a new item both properties: ID & QUANTITY are required",t);continue}let e={id:t.id,quantity:t.quantity};"object"!=typeof t.properties||toolBox.isEmpty(t.properties)||(e.properties=t.properties),toolBox.isEmpty(t.selling_plan)||(e.selling_plan=t.selling_plan),i.items.push(e)}else if(t==this.CART_REQUEST_TYPES.UPDATE)for(let t of r){if(!t.key||isNaN(t.quantity)){console.error("To update an existing item, both properties: KEY & QUANTITY are required",t);continue}let e={id:t.key,quantity:t.quantity};"object"!=typeof t.properties||toolBox.isEmpty(t.properties)||(e.properties=t.properties),toolBox.isEmpty(t.selling_plan)||(e.selling_plan=t.selling_plan),e.properties||e.selling_plan?o.push({type:this.CART_REQUEST_TYPES.CHANGE,request:e}):n.updates[e.id]=e.quantity}else if(t==this.CART_REQUEST_TYPES.REMOVE)for(let t of r)t.key?n.updates[t.key]=0:console.error("To remove an existing item KEY is required",t)}Object.keys(n.updates).length&&o.push({type:this.CART_REQUEST_TYPES.UPDATE,body:n}),i.items.length&&o.push({type:this.CART_REQUEST_TYPES.ADD,body:i});for(let t of o)this.postShopify(t.body,t.type,e)},b.prototype.clearCart=function(){this.postShopify.bind(this)({},"clear")},b.prototype.openPopup=function(e){var o=document.createElement("div");if(o.dataset.sczCartPopup,o.classList.add("scz-cart-popup"),e.title){var n=e.title.label,i=document.createElement("h2");i.classList.add("scz-cart-popup-title"),i.innerHTML=n,o.append(i)}if(e.form){var r=this.generateForm.bind(this)(e.form);console.log(r);var s=document.createElement("div");s.classList.add("scz-cart-popup-form"),s.append(r),o.append(s)}document.getElementById(t.section_id).append(o)},b.prototype.closePopup=function(t){},b.prototype.generateForm=function(t){var e=document.createElement("form");e.setAttribute("method","post"),e.setAttribute("action","#");for(const[c,p]of Object.entries(t)){var o=document.createElement("div");if("text"==t[c].type){if(t[c]){if((l=document.createElement("input")).type="text",l.name=c,l.id=c,t[c].required&&(l.required=t[c].required),t[c].placeholder&&(l.placeholder=t[c].placeholder),t[c].label)(a=document.createElement("Label")).htmlFor=c,a.innerHTML=t[c].label,o.appendChild(a);o.appendChild(l),e.appendChild(o)}}else if("select"==t[c].type){if(t[c]){var n=document.createElement("select");n.id=c,t[c].required&&(n.required=t[c].required);for(var i=0;i<t[c].options.length;i++){var r=document.createElement("option");r.value=t[c].options[i],r.text=t[c].options[i],n.appendChild(r)}if(t[c].label){var s=document.createElement("Label");s.htmlFor=c,s.innerHTML=t[c].label,o.appendChild(s)}o.appendChild(n),e.appendChild(o)}}else if("number"==t[c].type){if(t[c]){var a;if((l=document.createElement("input")).type="number",l.name=c,l.id=c,t[c].required&&(l.required=t[c].required),t[c].placeholder&&(l.placeholder=t[c].placeholder),t[c].label)(a=document.createElement("Label")).htmlFor=c,a.innerHTML=t[c].label,o.appendChild(a);o.appendChild(l),e.appendChild(o)}}else if("submit"==t[c].type){var l;if(t[c])(l=document.createElement("button")).type="submit",l.name=c,l.id=c,l.innerHTML=t[c].label,o.appendChild(l),e.appendChild(o)}}return console.log(e),e},b.prototype.postShopify=function(t,e,o){var n=this,i=!1;Array.isArray(n.requestsQueue)||(n.requestsQueue=[]);const r={formData:t,action:e,callbacks:o};if(n.requestsQueue.unshift(r),n.isUpdating)return;const s=n.requestsQueue.pop();if(t=s.formData,e=s.action,(o=s.callbacks||{}).onSuccess&&"function"==typeof o.onSuccess||(o.onSuccess=function(){}),o.onFailure&&"function"==typeof o.onFailure||(o.onFailure=function(){}),o.always&&"function"==typeof o.always||(o.always=function(){}),e==this.CART_REQUEST_TYPES.ADD)i="/cart/add.js";else if(e==this.CART_REQUEST_TYPES.UPDATE)i="/cart/update.js";else if(e==this.CART_REQUEST_TYPES.CHANGE)i="/cart/change.js";else{if(e!=this.CART_REQUEST_TYPES.CLEAR){if(n.requestsQueue.length){const t=n.requestsQueue.pop();return n.postShopify(t.formData,t.action,t.callbacks)}return console.error(`Can't post to Shopify. The action: ${e} is not valid`)}i="/cart/clear.js"}n.updateLoaderVisibilityState(!0),fetch(i,{method:"POST",credentials:"same-origin",headers:{"Content-Type":"application/json","X-Requested-With":"xmlhttprequest"},body:JSON.stringify(t)}).then(function(t){if(t.ok)return t.json();throw Error(t.statusText)}).then(function(t){try{o.onSuccess()}catch(t){console.error("Error executing onSuccess callback from postShopify",t)}}).catch(function(t){n.handleErrors(t);try{o.onFailure()}catch(t){console.error("Error executing onFailure callback from postShopify",t)}}).finally(function(){try{o.always()}catch(t){console.error("Error executing always callback from postShopify",t)}if(n.updateLoaderVisibilityState(!1),n.requestsQueue.length){const t=n.requestsQueue.pop();return n.postShopify(t.formData,t.action)}})},b.prototype.calculateShipping=function(t,e,o){if(!_.enabled)return;e?(localStorage.setItem(_.storage_key,JSON.stringify(t)),_.address=t):localStorage.setItem(_.storage_key,null);let n=[];for(let e in t)n.push(`shipping_address[${e}]=${t[e]}`);let i=n.length?"?"+n.join("&"):"";fetch("/cart/shipping_rates.json"+i,{method:"POST",credentials:"same-origin"}).then(t=>t.json()).then(function(t){t.shipping_rates&&t.shipping_rates.length?_.rates=t.shipping_rates:_.rates=null,"function"==typeof o&&o(t.shipping_rates||"Couldn't fetch shipping rates.")}).catch(t=>{console.error("Opps, something worng happened.",t),"function"==typeof o&&o(d.shipping_rates||"Couldn't fetch shipping rates.")})};const v=async function(){var t=await fetch(y.JSON);return await t.json()},k=async function(t){var e=fetch(y.CART);if(t)return e.then(t=>t.json());var o=await e;return await o.json()},E=function(t,e){var o=function(t,e){Array.isArray(e)||(e=[e]);for(const o of e)if(t.includes(o))return!0;return!1};const n=window.fetch;window.fetch=function(){return new Promise((i,r)=>{n.apply(this,arguments).then(async n=>{try{if(o(n.url,t)&&"cors"!=n.type&&n.ok){let t=await n.clone().json();"function"==typeof e&&e(t,n.url)}}catch(t){console.error("Something went wrong while intercepting cart update",t)}i(n)}).catch(t=>{r(t)})})};let i=XMLHttpRequest.prototype.send;XMLHttpRequest.prototype.send=function(){this.addEventListener("readystatechange",function(){o(this.responseURL,t)&&4===this.readyState&&200==this.status&&"function"==typeof e&&e(JSON.parse(this.response),this.responseURL)},!1),i.apply(this,arguments)},document.addEventListener("submit",function(t){if(!t.target||"form"!==t.target.tagName.toLowerCase()||t.target.matches("[sz-no-block]"))return;var e=t.target,o=new URL(e.action).pathname;if(!o.includes("/cart"))return;const n=new XMLHttpRequest,i=new FormData(e),r=this;n.addEventListener("load",function(t){r.updateCartVisibilityState(!0)}),n.addEventListener("error",function(t){console.log("Error submitting form",t),e.setAttribute("sz-no-block",""),e.submit()}),n.open("POST",o),n.send(i),t.preventDefault()}.bind(this))};return b};